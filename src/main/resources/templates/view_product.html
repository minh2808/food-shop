<!DOCTYPE html>
<html
  lang="vi"
  xmlns:th="http://www.thymeleaf.org"
  th:replace="~{base::layout(~{::section})}"
>
  <head>
    <title>Chi tiết sản phẩm</title>
    <style>
      .product-detail-container {
        padding-top: 3rem;
        padding-bottom: 5rem;
      }
      .product-image {
        border-radius: 10px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        object-fit: cover;
      }
      .price-display {
        background-color: #f7f7f7;
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
        border-left: 5px solid #ff0000;
      }
      /* Style cho khối tồn kho chi tiết */
      .stock-detail {
        margin-top: 15px;
        padding: 10px 15px;
        border-radius: 6px;
        font-size: 1.1rem;
        font-weight: 600;
      }
      .stock-low {
        background-color: #ffe0e0; /* Nền hồng nhạt */
        color: #dc3545; /* Chữ đỏ */
        border: 1px solid #dc3545;
      }
      .stock-ok {
        background-color: #e9f7ef; /* Nền xanh nhạt */
        color: #28a745; /* Chữ xanh lá */
      }
    </style>
    <meta charset="UTF-8" />
  </head>
  <body>
    <section>
      <div class="container product-detail-container">
        <div class="col-md-10 offset-md-1 p-4 bg-white rounded-3 shadow-lg">
          <h1 class="text-center mb-5 fw-bold accent-color">
            Chi tiết sản phẩm
          </h1>

          <div class="row">
            <div class="col-12 mb-4">
              <th:block th:if="${session.succMsg}">
                <div class="alert alert-success text-center" role="alert">
                  <i class="fa-solid fa-check me-2"></i> [[${session.succMsg}]]
                </div>
                <th:block
                  th:text="${@commonServiceImpl.removeSessionMessage()}"
                ></th:block>
              </th:block>

              <th:block th:if="${session.errorMsg}">
                <div class="alert alert-danger text-center" role="alert">
                  <i class="fa-solid fa-triangle-exclamation me-2"></i>
                  [[${session.errorMsg}]]
                </div>
                <th:block
                  th:text="${@commonServiceImpl.removeSessionMessage()}"
                ></th:block>
              </th:block>
            </div>

            <div class="col-md-5">
              <img
                alt="Hình ảnh sản phẩm"
                th:src="@{'/img/product/'+${product.image}}"
                class="product-image"
                width="100%"
                height="450px"
              />
            </div>

            <div class="col-md-7 ps-md-5">
              <p class="lead">
                <span class="fw-bold">Tên sản phẩm: </span
                ><span class="fs-4">[[${product.title}]]</span>
              </p>
              <p>
                <span class="fw-bold">Danh mục:</span>
                <span class="badge bg-secondary">[[${product.category}]]</span>
              </p>

              <h4 class="fw-bold mt-4">Mô tả</h4>
              <p class="text-muted">[[${product.description}]]</p>

              <div class="price-display">
                <span class="fs-2 fw-bold accent-color me-3"
                  >[[${@commonServiceImpl.formatVnd(product.discountPrice)}]]₫</span
                >
                <span
                  class="fs-4 text-decoration-line-through text-secondary me-2"
                  >[[${@commonServiceImpl.formatVnd(product.price)}]]₫</span
                >
                <span class="badge bg-danger fs-5"
                  >Giảm [[${product.discount}]]%</span
                >
              </div>

              <!-- Rating -->
              <div class="mt-3">
                <div class="mb-2">
                  <span class="fw-bold">Đánh giá: </span>
                  <th:block th:if="${product.ratingCount == 0}">
                    <span class="text-muted">Chưa có đánh giá</span>
                  </th:block>
                  <th:block th:unless="${product.ratingCount == 0}">
                    <span class="me-2"
                      >[[${#numbers.formatDecimal(product.averageRating,1,1)}]]</span
                    >
                    <span class="text-warning">
                      <th:block th:each="i : ${#numbers.sequence(1,5)}">
                        <i
                          class="fa-solid fa-star"
                          th:classappend="${product.averageRating >= i} ? ' text-warning' : ' text-secondary'"
                        ></i>
                      </th:block>
                    </span>
                    <small class="text-muted ms-2"
                      >([[${product.ratingCount}]] đánh giá)</small
                    >
                  </th:block>
                </div>

                <div>
                  <th:block th:if="${user == null}">
                    <small class="text-muted"
                      >Đăng nhập để đánh giá sản phẩm</small
                    >
                  </th:block>
                  <th:block th:unless="${user == null}">
                    <span class="me-2 fw-bold">Đánh giá ngay:</span>
                    <th:block th:each="i : ${#numbers.sequence(1,5)}">
                      <a
                        th:href="@{/user/rateProduct(pid=${product.id},rating=${i})}"
                        class="btn btn-sm btn-outline-secondary me-1"
                        th:title="${i} + ' sao'"
                        >[[${i}]] ★</a
                      >
                    </th:block>
                  </th:block>
                </div>
              </div>

              <div
                class="stock-detail"
                th:classappend="${product.stockQuantity <= 5} ? 'stock-low' : 'stock-ok'"
              >
                <th:block th:if="${product.stockQuantity > 0}">
                  <i class="fa-solid fa-boxes-stacked me-2"></i>
                  Còn hàng:
                  <span
                    th:text="${product.stockQuantity}"
                    class="fw-bolder"
                  ></span>
                  sản phẩm
                  <span th:if="${product.stockQuantity <= 5}" class="ms-2"
                    >(Sắp hết hàng!)</span
                  >
                </th:block>

                <th:block th:unless="${product.stockQuantity > 0}">
                  <i class="fa-solid fa-circle-xmark me-2"></i>
                  Hết hàng (Tạm thời không đặt được)
                </th:block>
              </div>
              <div class="mt-5 d-grid">
                <th:block th:if="${user==null}">
                  <a href="/signin" class="btn btn-accent-red btn-lg">
                    <i class="fa-solid fa-cart-plus me-2"></i> Đăng nhập để thêm
                    vào giỏ hàng
                  </a>
                </th:block>

                <th:block th:unless="${user==null}">
                  <a
                    th:href="@{/user/addCart(pid=${product.id},uid=${user.id})}"
                    class="btn btn-accent-red btn-lg"
                  >
                    <i class="fa-solid fa-cart-plus me-2"></i> Thêm vào giỏ hàng
                  </a>
                </th:block>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </body>
</html>
